"use strict";angular.module("teamDashboardApp",["highcharts-ng"]),angular.module("teamDashboardApp").controller("MainCtrl",["$log","teamSrvc",function(a,b){var c=this;c.teams=[{teamName:"Arsenal",id:"2",src:"2.json",checked:!0},{teamName:"Manchester City",id:"209",src:"209.json",checked:!0},{teamName:"Leicester",id:"572",src:"572.json",checked:!0}],c.config={pie:{chart:{type:"pie"},title:{text:"Results"},exporting:{enabled:!1},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},colors:["#90ed7d","#f76635","#434348"]},column:{chart:{type:"column"},title:{text:"Goals: Scored vs Taken"},exporting:{enabled:!1},xAxis:{categories:["Home","Away","Total"],title:{text:null}},yAxis:{min:0,title:{text:"Goals"},labels:{overflow:"justify"}},legend:{layout:"horizontal",align:"center",verticalAlign:"bottom",borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF",shadow:!0},tooltip:{valueSuffix:" goals"},colors:["#90ed7d","#f76635"]}},c.keepState=function(a,b){localStorage.setItem(a,b)},c.retrieveState=function(a){var b;return _.forEach(a,function(a){b=localStorage.getItem(a.teamName),b&&(a.checked="true"===b)}),a},c.drawCharts=function(c){b.buildSeries(c.teams,c.config).then(function(b){c.teamChart=c.retrieveState(b),a.info("Charts loaded.")},function(b){a.error("Error at drawCharts in MainCtrl: "+b)})},c.drawCharts(c)}]),angular.module("teamDashboardApp").service("teamSrvc",["$http","$q","$log",function(a,b,c){function d(d){for(var f=b.defer(),g=[],h=0;h<d.length;h++)g.push(a.get("/assets/json/"+d[h].src));return b.all(g).then(function(a){for(var b=0;b<a.length;b++)for(var g=0;g<d.length;g++)e(a[b].config.url)===d[g].src&&(d[g].data=a[b].data);c.info("getAllJson done"),f.resolve(d)},function(a){f.reject("Error at getAllJson trying to load data: "+a)}),f.promise}function e(a){return a.substring(_.lastIndexOf(a,"/")+1,a.length)}function f(a){var b;a.pieSerie=[],b=a.data.data.stats,a.pieSerie.push({name:"Percentage",data:[{name:"Won",y:b.won},{name:"Lost",y:b.lost,sliced:!0,selected:!0},{name:"Drawn",y:b.drawn}]}),c.info("Pie series added.")}function g(a){var b,d;a.colSerie=[],b=a.data.data.groups[0].ranking;for(var e=0;e<b.length;e++)b[e].team&&b[e].team.id===a.id&&(d=b[e].team.teamStats,a.colSerie.push({name:"Goals Scored",data:[d.goalsShotHome,d.goalsShotAway,d.goalsShot]},{name:"Goals Taken",data:[d.goalsGotHome,d.goalsGotAway,d.goalsGot]}));c.info("Column series added.")}function h(a,b){return{options:b,series:a}}var i=this;i.buildSeries=function(a,c){var e=b.defer();return d(a).then(function(a){var b,d,i=[];_.forEach(a,function(a){f(a),g(a),b=h(a.pieSerie,c.pie),d=h(a.colSerie,c.column),i.push({teamName:a.teamName,charts:[b,d],checked:a.checked})}),e.resolve(i)},function(a){e.reject("Error at buildSeries trying to load data: "+a)}),e.promise}}]),angular.module("teamDashboardApp").run(["$templateCache",function(a){a.put("views/main.html",'<div data-ng-controller="MainCtrl as mc" class="row"> <!-- loop through teams --> <div class="col-sm-6" data-ng-repeat="team in mc.teamChart"> <div class="panel panel-primary"> <div class="panel-heading"> <div class="row-fluid marginLeft"> <div class="checkbox"> <input type="checkbox" data-ng-model="team.checked" data-ng-click="mc.keepState(team.teamName, team.checked)"> </div> <h4 class="panel-title">{{team.teamName}}</h4> </div> </div> <!-- loop through charts per team --> <div data-ng-repeat="chart in team.charts" class="panel-body" data-ng-class="{disabled: !team.checked}"> <highchart config="chart"></highchart> </div> </div> </div> </div>')}]);